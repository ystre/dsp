= Test Guide

The project uses a custom _stage runner_, `./scripts/run.sh`. It is a CI-like
workflow that can be run on any machine.

The following utilities are used by the stages:

* `asciidoc` (https://github.com/asciidoc-py/asciidoc-py)
* `baldr` (https://github.com/ystre/baldr)
* `bc` (Arbitrary precision calculator)
* `docker compose`
* `docker`
* `helm`
* `inxi` (System information tool)
* `jq` (https://github.com/jqlang/jq)
* `k3s`
* `kcat` (https://github.com/edenhill/kcat)
* `keytool`
* `kubectl`
* `xxd`
* `yq` (https://github.com/kislyuk/yq)

= Test Specification

Note, this is only a design, test cases are to be implemented _Soon_ (TM).

== Runtime Framework

=== Functional Test Cases

* Daemon's signal handling
* Identity test: equality testing on southbound and northbound interface

=== Performance

* Start-up time
* End-to-end latency
* Shutdown time / Restart time
* Number of threads

== TCP Server

=== Functional Test Cases

* Establishing one connection
** Disconnecting without any data
** Sending data
*** Processing everything
*** Processing in chunks
*** Waiting for more data
* Simultaneous connections
** Not blocking each other
** Separate state for each connections

=== Performance

==== Scenarios

* One connection
** Different packet sizes (S, M, L)
* Multiple connections
** Scalability (total throughput / connection throughput)
** Upper bound

== Kafka Producer

NOTE: stub section

== Deployment test

Deployment testing includes packaging and Helm installing on a K3S cluster.

All required dependencies are linked statically. A single executable is copied
into a Docker image. It is then saved and imported into the K3S cluster (the
image is not uploaded anywhere).

Test commands depend on an already running cluster and having the namespace of
the default context set to _dsp_.

 sudo cp /etc/rancher/k3s/k3s.yaml ~/.kube/local.yaml
 sudo chown $USER ~/.kube/local.yaml
 kubectl config set-context --namespace dsp --current

Stages:

 ./scripts/run.sh build package deploy
